# 使用指南

本文档详细说明如何使用 Telegram 中文搜索 Bot 的各项功能。

## 目录

1. [快速开始](#快速开始)
2. [频道收集](#频道收集)
3. [搜索功能](#搜索功能)
4. [统计报表](#统计报表)
5. [爬虫管理](#爬虫管理)
6. [高级功能](#高级功能)

---

## 快速开始

### 第一次使用

1. 在 Telegram 中找到你的 Bot（例如: @jisousearchhelp_bot）
2. 发送 `/start` 命令
3. Bot 会显示欢迎信息和主菜单

### 主菜单

```
📖 使用方法：
/search <关键词> - 搜索内容
/stats - 查看统计
/help - 查看帮助

👑 管理员功能：
/channels - 频道列表
/report - 详细报表
/crawler_status - 爬虫状态
/add_channel <链接> - 添加频道
```

---

## 频道收集

Bot 可以自动提取消息中的频道链接。

### 方式 1: 转发消息到收集频道

1. 当你在其他地方看到有价值的频道链接时
2. 转发该消息到你的私有频道 `Channelcollect_jisou`
3. Bot 会自动提取链接并保存

**支持的链接格式：**

```
@channel_name
https://t.me/channel_name
t.me/channel_name
t.me/joinchat/xxxx
t.me/c/1234567890
```

### 方式 2: 手动添加频道

```
/add_channel @tech_news
/add_channel https://t.me/movie_share
```

### 自动分类

Bot 会根据频道名称和描述自动分类：

- 📰 新闻资讯
- 📱 科技数码
- 🎬 影视资源
- 🔧 软件工具
- 📚 电子书籍
- 🎓 学习教育
- 📦 资源分享
- 🎮 娱乐休闲
- 🏪 生活服务
- 💰 金融投资

---

## 搜索功能

### 基础搜索

```
/search Python
```

返回所有包含 "Python" 的内容。

### 多关键词搜索

```
/search Python 教程 入门
```

返回包含任意一个关键词的内容。

### 高级搜索

#### 按媒体类型过滤

```
/search Python type:video
```

只搜索视频内容。

支持的类型:
- `text` - 文本
- `photo` - 图片
- `video` - 视频
- `document` - 文档

#### 按频道过滤

```
/search Python channel:@tech_learning
```

只在指定频道中搜索。

#### 按日期过滤

```
/search Python date:2025-11
```

只搜索 2025年11月 的内容。

#### 组合过滤

```
/search Python教程 type:video channel:@tech_learning
```

### 搜索结果

搜索结果会显示：

```
🔍 搜索: "Python"
━━━━━━━━━━━━━━━━━━━━
找到 15 条结果

1. Python零基础入门教程，适合初学者...
   📺 @tech_learning (技术学习)
   🎬 video
   🕐 2025-10-28 14:30
   🔗 消息: 12345

2. Python爬虫实战项目...
   📺 @code_share
   📝 text
   🕐 2025-10-25 10:15
   🔗 消息: 67890
```

点击链接可以直达原始消息。

---

## 统计报表

### 总体统计

```
/stats
```

显示：

```
📊 系统总体统计
━━━━━━━━━━━━━━━━━━━━

📺 频道统计：
  • 总计: 156 个
  • 已验证: 102 个 ✅
  • 待验证: 54 个 ⏳
  • 失效/封禁: 12 个 ❌

📄 消息统计：
  • 总计: 12,450 条
  • 📝 text: 8,100
  • 📸 photo: 3,210
  • 🎬 video: 1,580
  • 📎 document: 890

⚙️ 爬虫状态：
  • 🔴 已禁用

🕐 生成时间: 2025-11-02 14:30:25
```

### 频道列表

```
/channels
```

分页显示所有收集的频道，支持翻页。

```
📺 频道列表 (第 1/10 页)
━━━━━━━━━━━━━━━━━━━━

1. ✅ ✅
   @tech_news
   📝 科技新闻频道
   📁 新闻资讯
   👥 52,000 成员
   🕐 2025-10-15

2. ⏳
   @movie_share
   📝 电影资源分享
   📁 影视资源
   🕐 2025-10-20

[◀️ 上一页] 1/10 [下一页 ▶️]
```

### 详细报表

```
/report
```

选择报表类型：

- 📊 总体统计
- 📺 频道列表
- 📁 分类统计
- 🔥 热门频道

#### 分类统计示例

```
📊 频道分类统计
━━━━━━━━━━━━━━━━━━━━

🎬 影视资源
[████████████░░░░░░░░] 50 个 (32.1%)

📱 科技数码
[███████░░░░░░░░░░░░░] 33 个 (21.2%)

📰 新闻资讯
[████░░░░░░░░░░░░░░░░] 23 个 (14.7%)
```

#### 热门频道示例

```
🔥 最活跃频道 Top 10
━━━━━━━━━━━━━━━━━━━━

🥇 1. @daily_tech
   📝 科技日报
   📁 科技数码
   📄 235 条消息

🥈 2. @news_channel
   📝 新闻快讯
   📁 新闻资讯
   📄 189 条消息
```

---

## 爬虫管理

爬虫功能用于自动加入频道并索引内容。

### 查看爬虫状态

```
/crawler_status
```

显示：

```
⚙️ 爬虫状态
━━━━━━━━━━━━━━━━━━━━

🔴 状态: 已禁用

配置信息:
• API ID: 已配置
• API Hash: 已配置
• 每日限制: 10 个频道

[🟢 启用爬虫]
```

### 启用爬虫

**前提条件：**
1. 已在 `.env` 中配置 `API_ID`、`API_HASH`
2. 首次启动已完成手机验证

**启用方法：**

```
/crawler_on
```

Bot 会回复：

```
✅ 爬虫已启用

⚠️ 注意: 需要重启 Bot 才能生效
```

然后重启 Bot:

```bash
sudo systemctl restart telegram-search-bot
```

### 禁用爬虫

```
/crawler_off
```

### 爬虫工作原理

启用后，爬虫会：

1. **自动加入频道**
   - 从数据库读取状态为 `pending` 的频道
   - 每天自动加入最多 10 个频道
   - 加入间隔 10-30 秒随机延迟

2. **监听新消息**
   - 实时监听已加入频道的新消息
   - 自动提取内容并建立索引

3. **转发到存储频道**
   - 将消息转发到私有存储频道
   - 记录消息ID用于链接直达

4. **健康检查**
   - 每5分钟检查连接状态
   - 自动重连

### 安全限制

为防止账号被封：

- 每天最多加入 10 个频道
- 操作间隔随机延迟（10-30秒）
- 自动处理限流错误
- 记录失败频道，避免重复尝试

---

## 高级功能

### 按钮式交互

所有命令都提供按钮式界面，点击按钮即可操作，无需记忆命令。

### 批量操作

#### 批量导入频道

在私有频道中一次性转发多条包含频道链接的消息，Bot 会自动提取所有链接。

### 数据导出

未来版本将支持：

- 导出频道列表为 CSV
- 导出搜索结果
- 数据库备份

---

## 常见问题

### Q: 为什么搜索不到内容？

**A:** 可能原因：

1. 还没有启用爬虫，数据库为空
2. 关键词拼写错误
3. 内容不在已索引的频道中

### Q: 如何删除某个频道？

**A:** 目前需要直接操作数据库：

```bash
sqlite3 data/channels.db
DELETE FROM channels WHERE channel_username = 'channel_name';
```

未来版本会添加 `/delete_channel` 命令。

### Q: 爬虫会不会被封号？

**A:** 采取了多重保护措施：

- 限制每日加入数量
- 随机延迟避免检测
- 建议使用专用小号

但仍存在风险，请谨慎使用。

### Q: 可以监控私有频道吗？

**A:** 可以，但前提：

1. 你的账号已加入该私有频道
2. 使用 UserBot 爬虫
3. 获取到私有频道的 ID

### Q: 搜索支持正则表达式吗？

**A:** 当前版本不支持，使用简单的关键词匹配。未来版本会考虑添加。

---

## 技巧与最佳实践

### 1. 构建优质频道库

- 从知名频道导航开始
- 关注质量而非数量
- 定期清理失效频道

### 2. 高效搜索

- 使用具体关键词而非泛泛搜索
- 善用类型和频道过滤
- 收藏常用搜索关键词

### 3. 数据管理

- 定期备份数据库
- 监控磁盘空间
- 清理无用消息

### 4. 爬虫使用

- 使用专门的小号
- 不要一次性加入太多频道
- 观察账号状态，如有异常立即停止

---

## 更新日志

### v1.0.0 (2025-11-02)

- ✅ 初始发布
- ✅ 频道链接自动提取
- ✅ 智能分类
- ✅ 全文搜索
- ✅ 统计报表
- ✅ UserBot 爬虫（可选）
- ✅ 按钮式交互界面

---

## 获取帮助

如需帮助，请：

1. 查看 [README.md](README.md)
2. 查看 [DEPLOYMENT.md](DEPLOYMENT.md)
3. 在 Bot 中发送 `/help`
4. 联系管理员

---

**祝你使用愉快！🎉**

